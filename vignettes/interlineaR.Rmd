---
title: "Importing interlinearized corpora and dictionaries as produced by descriptive linguistics softwares"
author: "Sylvain Loiseau"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Importing interlinearized corpora and dictionary into R}
  %\VignetteDepends{kableExtra}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(knitr)
library(interlineaR)
library(kableExtra)
```

# Introduction

This package contains utility functions for importing into R corpus
in various formats containing [*interlinearized corpora*](https://www.eva.mpg.de/lingua/resources/glossing-rules.php)
or dictionaryies produced by descriptive linguistics softwares, such as [SIL Toolbox](https://software.sil.org/toolbox/)
of [SIL Fieldworks](https://software.sil.org/fieldworks/).

All functions reading interlinearized text return a list of data frame, where each data frame correspond to an unit (text, sentence, word, morphem) and each row in the data frame describe an occurrence of the corresponding unit. The set of tables is relational: in each data frame, some columns give IDs pointing to rows in the other data frame: you can join morphems to the words, sentences or texts they belong to.

This pivot format allows for various reshaping into R (for instance, grouping morphems by words) as well as conversion between formats.

# Reading EMELD XML interlinear corpus

## Turning the EMELD XML document into a set of data frames

EMELD is an XML vocabulary introduced in Baden Hughes, Steven Bird and Catherine Bow, _Encoding and Presenting Interlinear Text Using XML Technologies_, [http://www.aclweb.org/anthology/U03-1008], it is used by SIL Fieldworks as an export format.

```{r}
corpuspath <- system.file("exampleData", "tuwariInterlinear.xml", package="interlineaR")
corpus <- read.emeld(corpuspath, vernacular.languages="tww")
```

The returned object is a named list. Each slot of the list contain a data.frame. They are named 'morphems', 'words', 'sentences', 'texts' (unless some of them have been discarted through the function arguments). Each row in the data frame describe an occurrences of a linguistic unit (texts, sentences, words, morphems.)

Let's look at the first rows of the "texts" data.frame:

```{r}
kable(head(corpus$morphems))
```

The first columns contain ''ids'' (referencing to which text, sentence or word each morphem belongs to). Other columns contains information extracted from the document. The names of the column are made of the field name and the language of the field, separated by a dot. (The parameters of read.emeld allow you to indicate which field, and in wich language(s), you are interested in, for each unit). Each field may be repeated in different languages.

The "words", "sentences" and "texts" table are made according to the same principles:

```{r}
kable(head(corpus$words))
```

```{r}

kable(head(corpus$sentences), booktabs = T)
```

```{r}
kable(head(corpus$texts))
```

## Contructing data set combining information from several data frame

This set of data.frame is similar to the tables of a database: rows from various tables are pointing to each other through ids.

Using these ids, new data.frame aggregating pieces of information coming from several data frame can be built. For instance, a table containing the columns of the morphems and the words can be built using:

```{r}
morphems_words <- merge(corpus$morphems, corpus$words[,-c(1,2)], by="word_id", suffixes = c(".morphem",".word"))
kable(head(morphems_words))
```

# Reading Toolbox interlinear corpus

Toolbox [https://software.sil.org/toolbox/] is widely used for producing interlinearized corpora. It uses a specific text-based format.

```{r}
corpuspath <- system.file("exampleData", "tuwariToolbox.txt", package="interlineaR")
corpus <- read.toolbox(corpuspath)
```

Just as read.emeld, the result is a list containing the slots 'morphems', 'sentences', 'words' and 'texts'. These slots are data frames, where each line describe an occurrence:

```{r}
kable(head(corpus$morphems))
```

As with read.emeld, optional fields can be declared. For instance, the kakabe corpus (by Alexandra Vydrina) also contains morphem glosses in russian and french

```{r}
path <- system.file("exampleData", "kakabe.txt", package="interlineaR")
corpus <- read.toolbox(path, morphem.fields.suppl = c("gr", "gf"))
kable(head(corpus$morphems))
```

The 'sentences' data frame contains a numeric id, the reference created for each sentence ("ref" field in toolbox), plus (as with read.emeld) the original text, the free translation as well as the note ("tx", "nt", "ft" field in toolbox).


```{r}
kable(head(corpus$sentences))
```

the text data.frame contains a numeric id and the title (toolbox ID) of each text.

# Reading LIFT XML dictionary

This XML vocabulary has been introduced by SIL : [http://code.google.com/p/lift-standard] and is used by SIL Fieldworks as an export format.

read.lift() produce a list of data frame: "entries", "senses", "examples" and "relations".

```{r}
dicpath <- system.file("exampleData", "tuwariDictionary.lift", package="interlineaR")
dictionary <- read.lift(dicpath, vernacular.languages="tww")
```

```{r}
kable(dictionary$entries)
```


